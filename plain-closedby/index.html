<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>closedby属性の作例</title>
  <style>
    html {
      height: 100%;
    }
    body {
      background-color: #fff;
      display: grid;
      height: 100%;
      place-content: center;
      row-gap: 16px;
      font-family: sans-serif;
      padding: 0;
      margin: 0;
    }
  </style>
</head>
<body>
  <div>
    <label>モーダルダイアログの設定：</label>
    <select name="closedbyValue" id="menu">
      <option value="default" selected>closedby 未設定</option>
      <option value="any">closedby="any"</option>
      <option value="closerequest">closedby="closerequest"</option>
      <option value="none">closedby="none"</option> 
    </select>
  </div>

  <button id="showDialog">モーダルダイアログを開く</button>

  <dialog>
    <p>次のいずれかの動作でモーダルダイアログを閉じることができます。</p>
    <div id="dialogContent"></div>
    <button id="closeDialog">閉じる</button>
  </dialog>

  <script>
    const showButton = document.querySelector("#showDialog");
    const dialogElement = document.querySelector("dialog");
    const dialogContent = dialogElement.querySelector("#dialogContent");
    showButton.addEventListener("click", () => {
      dialogElement.showModal();
    });

    const closeButton = document.querySelector("#closeDialog");
    closeButton.addEventListener("click", () => {
      dialogElement.close();
    });

    const MESSAGE_ESC = "ESCキーを押下";
    const MESSAGE_BACK_DROP = "ダイアログの背景を押下";  
    const MESSAGE_CLOSE_BUTTON = "閉じるボタンを押下";

    const MESSAGES = {
      default: [MESSAGE_ESC, MESSAGE_CLOSE_BUTTON],
      any: [MESSAGE_ESC, MESSAGE_BACK_DROP, MESSAGE_CLOSE_BUTTON],
      closerequest: [MESSAGE_ESC, MESSAGE_CLOSE_BUTTON],
      none: [MESSAGE_CLOSE_BUTTON],
    }

    const selectElement = document.querySelector("select");

    const updateDialogContent = () => {
      const beforeList = dialogContent.querySelector("ul");
      if(beforeList !== null) {
        dialogContent.removeChild(beforeList);
      }

      if(selectElement.value !== "default") {
        dialogElement.setAttribute("closedby", selectElement.value);
      } else {
        dialogElement.removeAttribute("closedby");
      }

      const newList = document.createElement("ul");
      MESSAGES[selectElement.value].forEach(text => {
        const li = document.createElement("li");
        li.textContent = text;
        newList.appendChild(li);
      });
      dialogContent.appendChild(newList);
    }

    selectElement.addEventListener("change", updateDialogContent);
    window.addEventListener("DOMContentLoaded", updateDialogContent);
  </script>
</body>
</html>
